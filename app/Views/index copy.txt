<!DOCTYPE html>
<html lang="id"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Lapor Pak WD III - Refined Complaint Form</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0D9488",
                        "primary-hover": "#0F766E",
                        "primary-light": "#CCFBF1",
                        "surface-bg": "#F8FAFC",
                        "card-bg": "#FFFFFF",
                        "border-light": "#E2E8F0",
                        "text-main": "#1E293B",
                        "text-muted": "#64748B",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    boxShadow: {
                        "glass": "0 4px 30px rgba(0, 0, 0, 0.1)",
                        "soft": "0 10px 40px -10px rgba(0,0,0,0.05)",
                    }
                },
            },
        }
    </script>
<style type="text/tailwindcss">
    .gradient-bg {
    /* background: linear-gradient(135deg, #059669 0%, #10b981 50%, #d97706 100%); */
    background: linear-gradient(135deg, #f59e0b 0%, #eab308 25%, #84cc16 50%, #22c55e 75%, #f59e0b 100%);
}
        @layer utilities {
            #notification-container {
                @apply flex flex-col gap-2;
            }
            .glass-header {
                @apply bg-primary shadow-lg border-b border-teal-700;
            }
            .form-input-base {
                @apply block w-full rounded-lg border-border-light bg-white py-3 px-4 text-text-main placeholder-text-muted focus:border-primary focus:ring-primary focus:ring-1 transition-all duration-200 shadow-sm text-sm sm:text-base;
            }
            .form-input-with-icon {
                @apply pl-12;
            }
            .form-select-base {
                @apply block w-full rounded-lg border-border-light bg-white py-3 pl-4 pr-10 text-text-main focus:border-primary focus:ring-primary focus:ring-1 transition-all duration-200 shadow-sm text-sm sm:text-base appearance-none;
            }
            .radio-card-active {
                @apply border-primary bg-primary-light/10 ring-1 ring-primary;
            }
            ::-webkit-scrollbar {
                width: 8px;
            }
            ::-webkit-scrollbar-track {
                background: #f1f1f1; 
            }
            ::-webkit-scrollbar-thumb {
                background: #cbd5e1; 
                border-radius: 4px;
            }
            ::-webkit-scrollbar-thumb:hover {
                background: #94a3b8; 
            }
            .input-error {
                @apply border-red-500 focus:border-red-500 focus:ring-red-500;
            }
            .input-success {
                @apply border-green-500 focus:border-green-500 focus:ring-green-500;
            }
            .error-message {
                @apply text-red-500 text-xs font-medium mt-1 flex items-center gap-1;
            }
            .toast-success {
                @apply bg-green-500 text-white px-6 py-3 rounded-lg shadow-md z-50 flex items-center gap-2 animate-slide-in mb-2;
            }
            .toast-error {
                @apply bg-red-500 text-white px-6 py-3 rounded-lg shadow-md z-50 flex items-center gap-2 animate-slide-in mb-2;
            }
            .toast-warning {
                @apply bg-yellow-500 text-white px-6 py-3 rounded-lg shadow-md z-50 flex items-center gap-2 animate-slide-in mb-2;
            }
            .toast-info {
                @apply bg-blue-500 text-white px-6 py-3 rounded-lg shadow-md z-50 flex items-center gap-2 animate-slide-in mb-2;
            }
            @keyframes slide-in {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slide-out {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
            .animate-slide-in {
                animation: slide-in 0.3s ease-out;
            }
            .animate-slide-out {
                animation: slide-out 0.3s ease-out forwards;
            }
            @keyframes spin {
                from {
                    transform: rotate(0deg);
                }
                to {
                    transform: rotate(360deg);
                }
            }
            .animate-spin {
                animation: spin 1s linear infinite;
            }
        }
    </style>
    <link rel="stylesheet" href="<?= base_url('assets/notiflix/notiflix-3.2.8.min.css'); ?>"/>
    <script src="<?= base_url('assets/notiflix/notiflix-3.2.8.min.js'); ?>"></script>
</head>
<body class="font-display bg-surface-bg text-text-main min-h-screen flex flex-col">

<!-- Notification Container -->
<div id="notification-container" class="fixed top-0 right-0 z-50 pointer-events-none"></div>

<header class="sticky top-0 z-50 w-full glass-header transition-all duration-300 ">
<div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex justify-between items-center">
<div class="flex items-center gap-3 sm:gap-4">
<div class="bg-white/20 p-2 rounded-lg backdrop-blur-sm">
<!-- <span class="material-symbols-outlined text-white text-2xl">school</span> -->
 <img src="./logo/ftik.png" alt="" class="w-8 h-8 object-contain">
</div>
<div>

<!-- <h1 class="text-lg md:text-xl font-bold text-white tracking-tight leading-none">Lapor Pak</h1>
<span class="text-xs font-medium text-teal-100 uppercase tracking-wider block mt-0.5">Wakil Dekan III</span> -->
<img src="./logo/logos.png" alt="" class="h-10 object-contain">
</div>
</div>
<div class="flex items-center gap-2">
<a class="flex group items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium text-teal-50 hover:bg-white/10 transition-all" href="#">
<span class="material-symbols-outlined text-[20px] group-hover:scale-110 transition-transform">lock</span>
<span>Login Admin</span>
</a>
</div>
</div>
</header>
<main class="flex-grow py-8 sm:py-12 px-4 sm:px-6">
<div class="max-w-4xl mx-auto space-y-8">
<div class="text-center space-y-4">
<div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-teal-50 border border-teal-100 text-teal-700 text-xs font-semibold uppercase tracking-wide">
<span class="w-2 h-2 rounded-full bg-teal-500 animate-pulse"></span>
                    Portal Pengaduan Digital
                </div>
<h2 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-extrabold text-slate-900 tracking-tight leading-tight">
                    Laporkan Keluhan Anda<br class="hidden sm:block"/> dengan <span class="text-primary">Aman &amp; Terpercaya</span>
</h2>
<p class="text-sm sm:text-base text-slate-500 max-w-xl mx-auto leading-relaxed">
                    <!-- Identitas Anda akan dirahasiakan sepenuhnya jika Anda memilih opsi Anonim. Kami berkomitmen untuk menciptakan lingkungan kampus yang transparan. -->
                     Aplikasi ini merupakan terobosan yang dibuat oleh Wakil Dekan 3 Fakultas Tarbiyah dan Ilmu Keguruan , sebagai sarana pelaporan berbagai hal terkait dugaan perilaku menyimpang oleh civitas akademika FTIK dan UIN Bukittinggi.
                </p>
</div>
<div class="bg-card-bg rounded-xl sm:rounded-2xl shadow-soft border border-slate-100 overflow-visible relative mx-auto w-full">
<div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary via-teal-400 to-emerald-400"></div>
<form class="p-5 sm:p-8 md:p-10 space-y-8" id="form-pengaduan">

<!-- ============================================
     SECTION 1: JENIS PELAPORAN (ANONIM/IDENTITAS)
     Memungkinkan user memilih apakah pengaduan anonim atau identitas tercatat
     ============================================ -->
<div class="space-y-4">
<div class="flex items-center justify-between">
<label class="text-sm font-bold text-slate-800 uppercase tracking-wider">Jenis Pelaporan</label>
<div class="group relative flex items-center cursor-help">
<span class="text-xs text-slate-500 mr-1 hidden sm:inline">Info Privasi</span>
<span class="material-symbols-outlined text-slate-400 text-sm">info</span>
<div class="absolute bottom-full left-1/2 sm:right-0 sm:left-auto mb-2 transform -translate-x-1/2 sm:translate-x-0 min-w-[14rem] max-w-[22rem] p-3 bg-slate-800 text-white text-sm rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 leading-relaxed break-words whitespace-normal">
                                    Pilih 'Anonim' untuk menyembunyikan identitas Anda dari petugas. Data pribadi tidak akan direkam.
                                </div>
</div>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
<label class="cursor-pointer relative w-full">
<input checked="" class="peer sr-only" name="pelapor_identitas" type="radio" value="anonim" id="pelapor_identitas_anonim"/>
<div class="p-4 rounded-xl border border-slate-200 bg-white hover:border-primary/50 hover:shadow-md transition-all peer-checked:border-primary peer-checked:bg-teal-50/30 peer-checked:ring-1 peer-checked:ring-primary flex items-center gap-4 h-full">
<div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 peer-checked:bg-primary peer-checked:text-white transition-colors shrink-0">
<span class="material-symbols-outlined">visibility_off</span>
</div>
<div>
<span class="block font-semibold text-slate-900 text-sm sm:text-base">Anonim</span>
<span class="text-xs text-slate-500">Identitas disembunyikan</span>
</div>
<div class="ml-auto opacity-0 peer-checked:opacity-100 text-primary transition-opacity">
<span class="material-symbols-outlined">check_circle</span>
</div>
</div>
</label>
<label class="cursor-pointer relative w-full">
<input class="peer sr-only" name="pelapor_identitas" type="radio" value="identitas" id="pelapor_identitas_named"/>
<div class="p-4 rounded-xl border border-slate-200 bg-white hover:border-primary/50 hover:shadow-md transition-all peer-checked:border-primary peer-checked:bg-teal-50/30 peer-checked:ring-1 peer-checked:ring-primary flex items-center gap-4 h-full">
<div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 peer-checked:bg-primary peer-checked:text-white transition-colors shrink-0">
<span class="material-symbols-outlined">badge</span>
</div>
<div>
<span class="block font-semibold text-slate-900 text-sm sm:text-base">Dengan Identitas</span>
<span class="text-xs text-slate-500">Identitas tercatat sistem</span>
</div>
<div class="ml-auto opacity-0 peer-checked:opacity-100 text-primary transition-opacity">
<span class="material-symbols-outlined">check_circle</span>
</div>
</div>
</label>
</div>
</div>

<!-- ============================================
     SECTION 2: INFO PRIVASI ANONIM
     Menampilkan informasi privasi ketika user memilih pengaduan anonim
     ============================================ -->
<!--opsi Anonim -->

<div id="anon-info" class="flex items-start gap-4 p-4 bg-gradient-to-r from-blue-50/80 to-white dark:from-blue-900/10 dark:to-transparent border border-blue-100 dark:border-blue-800 rounded-lg shadow-sm text-sm">
    <div class="flex-shrink-0">
        <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-700 dark:bg-blue-800 dark:text-blue-200 flex items-center justify-center">
            <span class="material-symbols-outlined text-lg">info</span>
        </div>
    </div>
    <div class="flex-1">
        <h4 class="text-sm font-semibold text-slate-900 dark:text-white">Privasi &amp; Keamanan</h4>
        <p class="mt-1 text-xs text-slate-600 dark:text-slate-300">Kami sangat menghargai privasi Anda. Pengaduan anonim diproses dengan serius oleh pihak Dekanat dan identitas Anda tidak akan tercatat ketika memilih opsi Anonim.</p>
    </div>
    <div class="hidden sm:flex items-center">
        <a class="text-xs font-medium text-primary hover:text-primary-hover" href="#">Pelajari lebih lanjut &rarr;</a>
    </div>
</div>

<!-- ============================================
     SECTION 3: IDENTITAS PERLAPOR
     Form untuk input nama dan kontak (Email/WhatsApp) - hanya tampil jika user memilih "Dengan Identitas"
     ============================================ -->
<!--  by identitas-->

<div id="identity-form" class="bg-slate-50 p-6 rounded-xl border border-slate-200 space-y-6 hidden">
<div class="flex items-center gap-2 border-b border-slate-200 pb-3 mb-2">
<span class="material-symbols-outlined text-slate-400">person_search</span>
<h3 class="text-sm font-bold text-slate-700 uppercase tracking-wide">Identitas Perlapor</h3>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="space-y-1.5">
<label class="block text-xs font-medium text-slate-500 uppercase">Nama *</label>
<input class="form-input-base w-full" placeholder="Contoh: Adam el-fathan" type="text" name="pelapor_nama" id="pelapor_nama"/>
</div>
<div class="space-y-1.5">
<label class="block text-xs font-medium text-slate-500 uppercase">Kontak yang bisa dihubungi (Email / Whastapp) *</label>
<input class="form-input-base w-full" placeholder="Contoh: adam@gmail.com" type="text" name="pelapor_kontak" id="pelapor_kontak"/>
</div>
</div>
</div>

<!-- End Info Perlapor -->

<!-- ============================================
     SECTION 4: KATEGORI PELANGGARAN
     Dropdown untuk memilih kategori pelanggaran dengan opsi tambah kategori custom
     ============================================ -->

<div class="border-t border-slate-100"></div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 items-start">
<!-- KATEGORI PELANGGARAN -->
<div class="space-y-2">
<label class="block text-sm font-semibold text-slate-700">Kategori Pelanggaran</label>
<div class="relative w-full" id="kategori-select-wrapper">
<select class="form-select-base" id="kategori_select" name="kategori_id" data-field-text="kategori_text">
<option disabled="" selected="">Pilih kategori masalah...</option>
<?php foreach ($kategori as $kat): ?>
    <option value="<?= $kat['id']; ?>"><?= esc($kat['kategori']); ?></option>    
<?php endforeach; ?>
<option>Lainnya</option>
</select>

</div>
<div id="kategori-custom-wrapper" class="space-y-2 hidden">
<input class="form-input-base w-full" id="kategori_custom_input" placeholder="Masukkan kategori baru..." type="text"/>
<div class="flex gap-2 justify-end">
<button type="button" class="text-xs font-semibold text-slate-600 hover:text-slate-700 flex items-center gap-1 transition-colors px-3 py-2 border border-slate-300 rounded-lg hover:bg-slate-50" id="btn-batal-kategori">
<span class="material-symbols-outlined text-[16px]">close</span> Batal
</button>
<button type="button" class="text-xs font-semibold text-white flex items-center gap-1 transition-colors px-3 py-2 bg-primary hover:bg-primary-hover rounded-lg" id="btn-tambah-kategori">
<span class="material-symbols-outlined text-[16px]">check</span> Tambah
</button>
</div>
</div>
<div class="flex justify-end pt-1" id="kategori-button-wrapper">
<button type="button" class="text-xs font-semibold text-primary hover:text-primary-hover flex items-center gap-1 transition-colors" id="btn-tambah-kategori-alt">
<span class="material-symbols-outlined text-[16px]">add</span> Tambah Kategori
                                </button>
</div>
</div>
<!-- END KATEGORI PELANGGARAN -->

<!-- ============================================
     SECTION 5: PIHAK YANG DILAPORKAN
     Dropdown untuk memilih jenis pihak yang dilaporkan (Mahasiswa/Dosen/Tendik/Lainnya)
     ============================================ -->
<!-- PIHAK YANG DILAPORKAN -->
<div class="space-y-2">
<label class="block text-sm font-semibold text-slate-700">Pihak yang Dilaporkan</label>
<div class="relative w-full">
<select class="form-select-base" name="terlapor_jenis" id="terlapor_jenis">
<option disabled="" selected="">Siapa yang dilaporkan...</option>
<option value="Mahasiswa">Mahasiswa</option>
<option value="Dosen">Dosen</option>
<option value="Tendik">Tenaga Kependidikan</option>
<option value="Lainnya">Lainnya</option>
</select>

</div>
</div>
</div>
<!-- END PIHAK YANG DILAPORKAN -->

<!-- ============================================
     SECTION 6: DETAIL TERLAPOR
     Form dinamis yang menampilkan field spesifik berdasarkan jenis pihak yang dipilih
     ============================================ -->

<!-- Detail Terlapor Jika Mahasiswa -->
<!-- DETAIL TERLAPOR - MAHASISWA: NIM, Nama Lengkap, Program Studi -->
<div id="detail-mahasiswa" class="bg-slate-50 p-6 rounded-xl border border-slate-200 space-y-6 hidden">
<div class="flex items-center gap-2 border-b border-slate-200 pb-3 mb-2">
<span class="material-symbols-outlined text-slate-400">person_search</span>
<h3 class="text-sm font-bold text-slate-700 uppercase tracking-wide">Detail Terlapor (Mahasiswa)</h3>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="space-y-1.5">
<label class="block text-xs font-medium text-slate-500 uppercase">NIM (Jika Mengetahui)</label>
<input class="form-input-base w-full" placeholder="Contoh: 12345678" type="text" name="terlapor_nim" id="terlapor_nim"/>
</div>
<div class="space-y-1.5">
<label class="block text-xs font-medium text-slate-500 uppercase">Nama Lengkap *</label>
<input class="form-input-base w-full" placeholder="Nama pihak yang dilaporkan" type="text" name="terlapor_nama_mahasiswa" id="terlapor_nama_mahasiswa"/>
</div>
<div class="md:col-span-2 space-y-1.5">
<label class="block text-xs font-medium text-slate-500 uppercase">Program Studi (Jika Mengetahui)</label>
<div class="relative w-full">
<select class="form-select-base" name="terlapor_prodi_id" id="terlapor_prodi_id">
<option disabled="" selected="">Pilih Program Studi...</option>
<?php foreach ($prodi as $prd): ?>
    <option value="<?= $prd['id']; ?>"><?= esc($prd['nm_prodi']); ?></option>
<?php endforeach; ?>
</select>

</div>
</div>
</div>
</div>

<!-- Detail Terlapor Jika Dosen -->
<!-- DETAIL TERLAPOR - DOSEN: Nama Lengkap saja -->
<div id="detail-dosen" class="bg-slate-50 p-6 rounded-xl border border-slate-200 space-y-6 hidden">
<div class="flex items-center gap-2 border-b border-slate-200 pb-3 mb-2">
<span class="material-symbols-outlined text-slate-400">person_search</span>
<h3 class="text-sm font-bold text-slate-700 uppercase tracking-wide">Detail Terlapor (Dosen)</h3>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="space-y-1.5">
<label class="block text-xs font-medium text-slate-500 uppercase">Nama Lengkap *</label>
<input class="form-input-base w-full" placeholder="Nama dosen yang dilaporkan" type="text" name="terlapor_nama_dosen" id="terlapor_nama_dosen"/>
</div>
</div>
</div>

<!-- Detail Terlapor Jika Tenaga Kependidikan -->
<!-- DETAIL TERLAPOR - TENAGA KEPENDIDIKAN: Nama Lengkap saja -->
<div id="detail-tendik" class="bg-slate-50 p-6 rounded-xl border border-slate-200 space-y-6 hidden">
<div class="flex items-center gap-2 border-b border-slate-200 pb-3 mb-2">
<span class="material-symbols-outlined text-slate-400">person_search</span>
<h3 class="text-sm font-bold text-slate-700 uppercase tracking-wide">Detail Terlapor (Tenaga Kependidikan)</h3>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="space-y-1.5">
<label class="block text-xs font-medium text-slate-500 uppercase">Nama Lengkap *</label>
<input class="form-input-base w-full" placeholder="Nama tenaga kependidikan yang dilaporkan" type="text" name="terlapor_nama_tendik" id="terlapor_nama_tendik"/>
</div>
</div>
</div>

<!-- Detail Terlapor Jika Lainnya -->
<!-- DETAIL TERLAPOR - LAINNYA: Nama Lengkap saja -->
<div id="detail-lainnya" class="bg-slate-50 p-6 rounded-xl border border-slate-200 space-y-6 hidden">
<div class="flex items-center gap-2 border-b border-slate-200 pb-3 mb-2">
<span class="material-symbols-outlined text-slate-400">person_search</span>
<h3 class="text-sm font-bold text-slate-700 uppercase tracking-wide">Detail Terlapor (Lainnya)</h3>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="space-y-1.5">
<label class="block text-xs font-medium text-slate-500 uppercase">Nama Lengkap *</label>
<input class="form-input-base w-full" placeholder="Nama orang yang dilaporkan" type="text" name="terlapor_nama_lainnya" id="terlapor_nama_lainnya"/>
</div>
</div>
</div>

<!-- End Detail Terlapor -->

<!-- ============================================
     SECTION 7: DESKRIPSI KEJADIAN
     Text area untuk mendeskripsikan kronologi kejadian secara detail
     ============================================ -->
<div class="space-y-2">
<div class="flex justify-between items-center">
<label class="block text-sm font-semibold text-slate-700">Deskripsi Kejadian</label>
<span class="text-xs font-medium bg-slate-100 text-slate-500 px-2 py-1 rounded-md">0/2000</span>
</div>
<textarea class="form-input-base resize-y min-h-[100px] md:min-h-[60px] w-full" placeholder="Ceritakan kronologi kejadian secara detail, obyektif dan jelas..." rows="3" name="kejadian_deskripsi" id="kejadian_deskripsi"></textarea>
<p class="text-xs text-slate-400 flex items-start gap-1 pt-1">
<!-- <span class="material-symbols-outlined text-[14px] mt-0.5 shrink-0">info</span> -->
                            Mohon gunakan bahasa yang sopan dan hindari fitnah.
                        </p>
</div>

<!-- ============================================
     SECTION 8: TANGGAL DAN LOKASI KEJADIAN
     Input date untuk tanggal kejadian dan text input untuk lokasi
     ============================================ -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
<div class="space-y-2">
<label class="block text-sm font-semibold text-slate-700">Tanggal Kejadian</label>
<div class="relative w-full">
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-slate-400">
<span class="material-symbols-outlined text-[20px]">calendar_today</span>
</div>
<input class="form-input-base form-input-with-icon text-slate-700 w-full" type="date" name="kejadian_tgl" id="kejadian_tgl"/>
</div>
</div>
<div class="space-y-2">
<label class="block text-sm font-semibold text-slate-700">Lokasi Kejadian</label>
<div class="relative w-full">
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-slate-400">
<span class="material-symbols-outlined text-[20px]">pin_drop</span>
</div>
<input class="form-input-base form-input-with-icon w-full" placeholder="Contoh: Gedung A, Lantai 2" type="text" name="kejadian_lokasi" id="kejadian_lokasi"/>
</div>
</div>
</div>

<!-- ============================================
     SECTION 9: BUKTI PENDUKUNG
     File upload area untuk menambahkan bukti/lampiran (PNG, JPG, PDF max 10MB)
     ============================================ -->
<div class="space-y-4">
<label class="block text-sm font-semibold text-slate-700">Bukti Pendukung <span class="text-xs font-normal text-slate-500">(Opsional)</span></label>

<!-- Opsi Tipe Bukti -->
<div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
<label class="cursor-pointer">
<input type="radio" name="bukti_tipe" value="file" checked class="peer sr-only" id="bukti_tipe_file"/>
<div class="p-3 rounded-lg border border-slate-200 bg-white hover:border-primary/50 peer-checked:border-primary peer-checked:bg-primary/5 transition-all">
<div class="flex items-center gap-2">
<span class="material-symbols-outlined">description</span>
<span class="text-sm font-medium text-slate-700">File/Gambar</span>
</div>
<p class="text-xs text-slate-500 mt-1">Upload bukti (PNG, JPG, PDF)</p>
</div>
</label>
<label class="cursor-pointer">
<input type="radio" name="bukti_tipe" value="sosmed" class="peer sr-only" id="bukti_tipe_sosmed"/>
<div class="p-3 rounded-lg border border-slate-200 bg-white hover:border-primary/50 peer-checked:border-primary peer-checked:bg-primary/5 transition-all">
<div class="flex items-center gap-2">
<span class="material-symbols-outlined">link</span>
<span class="text-sm font-medium text-slate-700">Link Sosial Media</span>
</div>
<p class="text-xs text-slate-500 mt-1">Bagikan link dari sosmed</p>
</div>
</label>
</div>

<!-- SECTION: UPLOAD FILE -->
<div id="bukti-file-section" class="w-full space-y-3">
<label class="flex flex-col items-center justify-center w-full h-32 md:h-40 border-2 border-dashed border-slate-300 rounded-xl cursor-pointer bg-slate-50 hover:bg-slate-100 hover:border-primary/50 transition-all duration-300 group" for="lampiran">
<div class="flex flex-col items-center justify-center pt-4 pb-5 text-center px-4">
<div class="mb-2 md:mb-3 p-2 md:p-3 rounded-full bg-white shadow-sm text-slate-400 group-hover:text-primary transition-colors">
<span class="material-symbols-outlined text-2xl md:text-3xl">cloud_upload</span>
</div>
<p class="mb-1 text-sm text-slate-600 font-medium"><span class="text-primary hover:underline">Klik upload</span> <span class="hidden sm:inline">atau drag &amp; drop</span></p>
<p class="text-[10px] sm:text-xs text-slate-400">Format: PNG, JPG, PDF (Max. 10MB)</p>
</div>
<input class="hidden" id="lampiran" type="file" name="lampiran"/>
</label>

<!-- FILE PREVIEW AREA -->
<div id="file-preview-container" class="hidden mt-3 p-4 bg-slate-50 rounded-xl border border-slate-200 space-y-3">
<div class="flex items-center justify-between">
<h4 class="text-sm font-semibold text-slate-700">Preview File</h4>
<button type="button" id="btn-remove-file" class="text-xs font-medium text-red-500 hover:text-red-700 flex items-center gap-1">
<span class="material-symbols-outlined text-[16px]">delete</span> Hapus
</button>
</div>
<div id="file-preview-content" class="space-y-2">
<!-- Preview content akan di-generate oleh JavaScript -->
</div>
</div>
</div>

<!-- SECTION: LINK SOSIAL MEDIA -->
<div id="bukti-sosmed-section" class="hidden w-full space-y-4">
<div class="space-y-3">
<label class="block text-sm font-semibold text-slate-700">Pilih Platform</label>
<div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
<label class="cursor-pointer">
<input type="radio" name="sosmed_platform" value="youtube" class="peer sr-only" id="sosmed_youtube"/>
<div class="p-3 rounded-lg border border-slate-200 hover:border-red-500 peer-checked:border-red-500 peer-checked:bg-red-50 text-center transition-all">
<span class="text-2xl mb-1 block">‚ñ∂Ô∏è</span>
<span class="text-xs font-medium text-slate-700">YouTube</span>
</div>
</label>
<label class="cursor-pointer">
<input type="radio" name="sosmed_platform" value="tiktok" class="peer sr-only" id="sosmed_tiktok"/>
<div class="p-3 rounded-lg border border-slate-200 hover:border-black peer-checked:border-black peer-checked:bg-slate-100 text-center transition-all">
<span class="text-2xl mb-1 block">‚ô™</span>
<span class="text-xs font-medium text-slate-700">TikTok</span>
</div>
</label>
<label class="cursor-pointer">
<input type="radio" name="sosmed_platform" value="instagram" class="peer sr-only" id="sosmed_instagram"/>
<div class="p-3 rounded-lg border border-slate-200 hover:border-pink-500 peer-checked:border-pink-500 peer-checked:bg-pink-50 text-center transition-all">
<span class="text-2xl mb-1 block">üì∑</span>
<span class="text-xs font-medium text-slate-700">Instagram</span>
</div>
</label>
<label class="cursor-pointer">
<input type="radio" name="sosmed_platform" value="facebook" class="peer sr-only" id="sosmed_facebook"/>
<div class="p-3 rounded-lg border border-slate-200 hover:border-blue-600 peer-checked:border-blue-600 peer-checked:bg-blue-50 text-center transition-all">
<span class="text-2xl mb-1 block">f</span>
<span class="text-xs font-medium text-slate-700">Facebook</span>
</div>
</label>
<label class="cursor-pointer">
<input type="radio" name="sosmed_platform" value="linkedin" class="peer sr-only" id="sosmed_linkedin"/>
<div class="p-3 rounded-lg border border-slate-200 hover:border-blue-700 peer-checked:border-blue-700 peer-checked:bg-blue-50 text-center transition-all">
<span class="text-2xl mb-1 block">in</span>
<span class="text-xs font-medium text-slate-700">LinkedIn</span>
</div>
</label>
</div>
</div>

<div class="space-y-1.5">
<label class="block text-sm font-semibold text-slate-700">Link URL</label>
<input type="url" id="sosmed_url" name="sosmed_url" placeholder="https://..." class="form-input-base w-full" />
<p class="text-xs text-slate-500 flex items-start gap-1">
<span class="material-symbols-outlined text-[14px] mt-0.5">info</span>
Paste link lengkap dari post/video yang ingin Anda jadikan bukti
</p>
</div>

<button type="button" id="btn-load-sosmed-preview" class="w-full sm:w-auto px-4 py-2 bg-primary hover:bg-primary-hover text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-2 justify-center">
<span class="material-symbols-outlined text-[18px]">preview</span> Preview
</button>

<!-- SOSMED PREVIEW AREA -->
<div id="sosmed-preview-container" class="hidden p-4 bg-slate-50 rounded-xl border border-slate-200 space-y-3">
<div class="flex items-center justify-between">
<h4 class="text-sm font-semibold text-slate-700">Preview Link</h4>
<button type="button" id="btn-remove-sosmed" class="text-xs font-medium text-red-500 hover:text-red-700 flex items-center gap-1">
<span class="material-symbols-outlined text-[16px]">delete</span> Hapus
</button>
</div>
<div id="sosmed-preview-content" class="space-y-3">
<!-- Preview content akan di-generate oleh JavaScript -->
</div>
</div>
</div>
</div>

<!-- ============================================
     SECTION 10: CHECKBOX PERSETUJUAN
     User harus menyetujui pernyataan kebenaran data sebelum mengirim pengaduan
     ============================================ -->
<div class="flex flex-col items-start pt-4 space-y-6">
<div class="flex items-start gap-3">
<input class="w-5 h-5 mt-0.5 cursor-pointer accent-primary" id="agree_checkbox" type="checkbox"/>
<label class="text-sm text-slate-600 cursor-pointer" for="agree_checkbox">
Saya menyatakan bahwa data yang saya berikan adalah benar, jujur, dan dapat dipertanggungjawabkan sesuai hukum yang berlaku. <span class="text-red-500">*</span>
</label>
</div>

<!-- ============================================
     SECTION 11: TOMBOL KIRIM PENGADUAN
     Tombol submit untuk mengirimkan pengaduan (dengan validasi checkbox persetujuan)
     ============================================ -->
<div class="w-full space-y-4">
<button class="group relative w-full flex justify-center py-4 px-6 border border-transparent text-base font-bold rounded-xl text-white bg-gradient-to-r from-primary to-teal-600 hover:from-primary-hover hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary shadow-lg shadow-teal-500/20 transition-all duration-200 transform hover:-translate-y-0.5 active:translate-y-0" id="btn-kirim-pengaduan" type="button">
<span class="absolute left-0 inset-y-0 flex items-center pl-4">
<span class="material-symbols-outlined group-hover:translate-x-1 transition-transform text-xl">send</span>
</span>
                                KIRIM PENGADUAN SEKARANG
                            </button>
</div>
</div>
<!-- END FORM PENGADUAN -->
</form>
</div>
</div>
</main>


<footer class="bg-white border-t border-slate-100 mt-auto">
<div class="max-w-7xl mx-auto py-6 sm:py-8 px-4 sm:px-6 lg:px-8">
<div class="flex flex-col md:flex-row justify-between items-center gap-4 text-center md:text-left">
<p class="text-xs sm:text-sm text-slate-400">¬© 2025 Kantor Wakil Dekan III FTIK - UIN SMDD Bukittinggi. All rights reserved.</p>
<div class="flex flex-col sm:flex-row flex-wrap justify-center gap-2 sm:gap-6 text-xs sm:text-sm">
<a class="text-slate-500 hover:text-primary transition-colors" href="#">Kebijakan Privasi</a>
<a class="text-slate-500 hover:text-primary transition-colors" href="#">Panduan Pengaduan</a>
<a class="text-slate-500 hover:text-primary transition-colors" href="#">Bantuan</a>
</div>
</div>
</div>
</footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(function(){
        // Fungsi untuk menampilkan/menyembunyikan form identitas berdasarkan jenis pengaduan
        function updateIdentity(){
            var val = $('input[name="pelapor_identitas"]:checked').val();
            if(val === 'anonim'){
                $('#anon-info').removeClass('hidden');
                $('#identity-form').addClass('hidden');
            } else {
                $('#anon-info').addClass('hidden');
                $('#identity-form').removeClass('hidden');
            }
        }
        $('input[name="pelapor_identitas"]').on('change', updateIdentity);
        updateIdentity();

        // Fungsi untuk menampilkan/menyembunyikan detail terlapor berdasarkan jenis
        function updateTerlapor(){
            var val = $('#terlapor_jenis').val();
            
            // Sembunyikan semua detail terlapor terlebih dahulu
            $('#detail-mahasiswa').addClass('hidden');
            $('#detail-dosen').addClass('hidden');
            $('#detail-tendik').addClass('hidden');
            $('#detail-lainnya').addClass('hidden');
            
            // Tampilkan detail sesuai pilihan
            if(val === 'Mahasiswa'){
                $('#detail-mahasiswa').removeClass('hidden');
            } else if(val === 'Dosen'){
                $('#detail-dosen').removeClass('hidden');
            } else if(val === 'Tendik'){
                $('#detail-tendik').removeClass('hidden');
            } else if(val === 'Lainnya'){
                $('#detail-lainnya').removeClass('hidden');
            }
        }
        
        $('#terlapor_jenis').on('change', updateTerlapor);
        updateTerlapor(); // Jalankan saat halaman load untuk menyembunyikan input

        // Fungsi untuk menampilkan/menyembunyikan input kategori custom
        function updateKategori(){
            var val = $('#kategori_select').val();
            
            if(val === 'Lainnya'){
                $('#kategori-select-wrapper').addClass('hidden');
                $('#kategori-custom-wrapper').removeClass('hidden');
                $('#kategori-button-wrapper').addClass('hidden');
                $('#kategori_custom_input').focus();
            } else {
                $('#kategori-select-wrapper').removeClass('hidden');
                $('#kategori-custom-wrapper').addClass('hidden');
                $('#kategori-button-wrapper').removeClass('hidden');
                $('#kategori_custom_input').val('');
            }
        }

        $('#kategori_select').on('change', updateKategori);

        // Event handler untuk tombol Tambah Kategori (dari halaman list)
        $('#btn-tambah-kategori-alt').on('click', function(e){
            e.preventDefault();
            $('#kategori_select').val('Lainnya').change();
        });

        // Event handler untuk tombol Tambah Kategori (dari halaman input)
        $('#btn-tambah-kategori').on('click', function(e){
            e.preventDefault();
            var kategoriNama = $('#kategori_custom_input').val().trim();
            
            if(kategoriNama === ''){
                alert('Silakan masukkan nama kategori terlebih dahulu');
                $('#kategori_custom_input').focus();
                return;
            }

            // Tambahkan kategori baru ke select
            var newOption = $('<option></option>')
                .val(kategoriNama)
                .text(kategoriNama);
            
            // Hapus opsi "Lainnya" terlebih dahulu jika ada
            $('#kategori_select option[value="Lainnya"]').remove();
            
            // Tambahkan opsi baru
            $('#kategori_select').append(newOption);
            
            // Tambahkan kembali opsi "Lainnya"
            $('#kategori_select').append($('<option></option>').val('Lainnya').text('Lainnya'));
            
            // Set nilai select ke kategori yang baru ditambahkan
            $('#kategori_select').val(kategoriNama);
            
            // Tampilkan select kembali dan sembunyikan input
            $('#kategori-select-wrapper').removeClass('hidden');
            $('#kategori-custom-wrapper').addClass('hidden');
            $('#kategori-button-wrapper').removeClass('hidden');
            $('#kategori_custom_input').val('');
        });

        // Event handler untuk tombol Batal
        $('#btn-batal-kategori').on('click', function(e){
            e.preventDefault();
            // Reset ke default option
            $('#kategori_select').prop('selectedIndex', 0);
            
            // Tampilkan select kembali dan sembunyikan input
            $('#kategori-select-wrapper').removeClass('hidden');
            $('#kategori-custom-wrapper').addClass('hidden');
            $('#kategori-button-wrapper').removeClass('hidden');
            $('#kategori_custom_input').val('');
        });

        // Handle Enter key pada input kategori custom
        $('#kategori_custom_input').on('keypress', function(e){
            if(e.which === 13){ // Enter key
                e.preventDefault();
                $('#btn-tambah-kategori').click();
            }
        });

        // ============================================
        // NOTIFIKASI TOAST SYSTEM
        // ============================================
        const Toast = {
            show: function(message, type = 'info', duration = 4000) {
                const icons = {
                    success: 'check_circle',
                    error: 'error',
                    warning: 'warning',
                    info: 'info'
                };
                
                const toast = $(`
                    <div class="pointer-events-auto toast-${type} p-4 rounded-lg shadow-lg flex items-center gap-3">
                        <span class="material-symbols-outlined">${icons[type]}</span>
                        <span>${message}</span>
                        <button class="ml-auto text-white/80 hover:text-white transition-colors">
                            <span class="material-symbols-outlined text-[20px]">close</span>
                        </button>
                    </div>
                `);
                
                $('#notification-container').append(toast);
                
                toast.find('button').click(function() {
                    toast.addClass('animate-slide-out');
                    setTimeout(() => toast.remove(), 300);
                });
                
                setTimeout(() => {
                    toast.addClass('animate-slide-out');
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }
        };

        // ============================================
        // FILE UPLOAD & PREVIEW
        // ============================================
        const FileHandler = {
            allowedFormats: ['image/png', 'image/jpeg', 'application/pdf'],
            maxSize: 10 * 1024 * 1024, // 10MB
            selectedFile: null,

            init: function() {
                const input = $('#lampiran');
                
                // Drag & drop
                const uploadArea = input.closest('label');
                uploadArea.on('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.addClass('border-primary bg-primary/5');
                });
                
                uploadArea.on('dragleave', () => {
                    uploadArea.removeClass('border-primary bg-primary/5');
                });
                
                uploadArea.on('drop', (e) => {
                    e.preventDefault();
                    uploadArea.removeClass('border-primary bg-primary/5');
                    const files = e.originalEvent.dataTransfer.files;
                    if (files.length > 0) {
                        this.handleFileSelect(files[0]);
                    }
                });
                
                // Normal file input
                input.on('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.handleFileSelect(e.target.files[0]);
                    }
                });
                
                // Remove file button
                $('#btn-remove-file').on('click', (e) => {
                    e.preventDefault();
                    this.removeFile();
                });
            },

            handleFileSelect: function(file) {
                // Validasi format
                if (!this.allowedFormats.includes(file.type)) {
                    Toast.show('Format file tidak didukung. Gunakan PNG, JPG, atau PDF', 'error');
                    return;
                }
                
                // Validasi ukuran
                if (file.size > this.maxSize) {
                    Toast.show('Ukuran file terlalu besar. Maksimal 10MB', 'error');
                    return;
                }
                
                this.selectedFile = file;
                this.showPreview(file);
                Toast.show('File berhasil diunggah', 'success');
            },

            showPreview: function(file) {
                const container = $('#file-preview-container');
                const content = $('#file-preview-content');
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                const fileType = file.type.startsWith('image') ? 'image' : 'document';
                
                if (fileType === 'image') {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const previewHtml = `
                            <div class="flex items-start gap-3 p-3 bg-white rounded-lg border border-slate-200">
                                <img src="${e.target.result}" alt="Preview" class="w-24 h-24 object-cover rounded-lg"/>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-slate-700">${file.name}</p>
                                    <p class="text-xs text-slate-500 mt-1">${fileSize} MB</p>
                                    <span class="inline-block mt-2 px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">‚úì Siap Upload</span>
                                </div>
                            </div>
                        `;
                        content.html(previewHtml);
                    };
                    reader.readAsDataURL(file);
                } else {
                    const previewHtml = `
                        <div class="flex items-start gap-3 p-3 bg-white rounded-lg border border-slate-200">
                            <div class="w-24 h-24 bg-red-50 rounded-lg border border-red-200 flex items-center justify-center shrink-0">
                                <span class="material-symbols-outlined text-red-400 text-4xl">description</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-slate-700">${file.name}</p>
                                <p class="text-xs text-slate-500 mt-1">${fileSize} MB</p>
                                <span class="inline-block mt-2 px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">‚úì Siap Upload</span>
                            </div>
                        </div>`;
                    content.html(previewHtml);
                }
                
                container.removeClass('hidden');
            },

            removeFile: function() {
                this.selectedFile = null;
                $('#lampiran').val('');
                $('#file-preview-container').addClass('hidden');
                Toast.show('File dihapus', 'warning');
            }
        };

        // ============================================
        // SOCIAL MEDIA LINK HANDLER
        // ============================================
        const SosmedHandler = {
            selectedUrl: null,
            selectedPlatform: null,

            init: function() {
                // Toggle antara file dan sosmed
                $('input[name="bukti_tipe"]').on('change', (e) => {
                    this.toggleBuktiType(e.target.value);
                });

                // Load preview button
                $('#btn-load-sosmed-preview').on('click', () => {
                    this.handlePreview();
                });

                // Remove button
                $('#btn-remove-sosmed').on('click', (e) => {
                    e.preventDefault();
                    this.removeSosmed();
                });
            },

            toggleBuktiType: function(type) {
                if (type === 'file') {
                    $('#bukti-file-section').removeClass('hidden');
                    $('#bukti-sosmed-section').addClass('hidden');
                    this.removeSosmed();
                } else {
                    $('#bukti-file-section').addClass('hidden');
                    $('#bukti-sosmed-section').removeClass('hidden');
                    FileHandler.removeFile();
                }
            },

            handlePreview: function() {
                const platform = $('input[name="sosmed_platform"]:checked').val();
                const url = $('#sosmed_url').val().trim();

                if (!platform) {
                    Toast.show('Pilih platform terlebih dahulu', 'warning');
                    return;
                }

                if (!url) {
                    Toast.show('Masukkan URL terlebih dahulu', 'warning');
                    return;
                }

                if (!this.isValidUrl(url)) {
                    Toast.show('URL tidak valid', 'error');
                    return;
                }

                // Validasi platform specific
                if (!this.isValidPlatformUrl(platform, url)) {
                    Toast.show(`URL tidak sesuai dengan platform ${platform}`, 'error');
                    return;
                }

                this.selectedUrl = url;
                this.selectedPlatform = platform;
                this.showPreview(platform, url);
                Toast.show('Preview berhasil dimuat', 'success');
            },

            isValidUrl: function(url) {
                try {
                    new URL(url);
                    return true;
                } catch (e) {
                    return false;
                }
            },

            isValidPlatformUrl: function(platform, url) {
                const patterns = {
                    youtube: /(?:youtube\.com|youtu\.be|m\.youtube\.com)/i,
                    tiktok: /(?:tiktok\.com|vm\.tiktok\.com|vt\.tiktok\.com|m\.tiktok\.com)/i,
                    instagram: /(?:instagram\.com|instagr\.am)/i,
                    facebook: /(?:facebook\.com|fb\.com|m\.facebook\.com)/i,
                    linkedin: /(?:linkedin\.com)/i
                };
                
                return patterns[platform] ? patterns[platform].test(url) : true;
            },

            showPreview: function(platform, url) {
                const container = $('#sosmed-preview-container');
                const content = $('#sosmed-preview-content');
                let previewHtml = '';

                switch(platform) {
                    case 'youtube':
                        previewHtml = this.getYoutubePreview(url);
                        break;
                    case 'tiktok':
                        previewHtml = this.getTiktokPreview(url);
                        break;
                    case 'instagram':
                        previewHtml = this.getInstagramPreview(url);
                        break;
                    case 'facebook':
                        previewHtml = this.getFacebookPreview(url);
                        break;
                    case 'linkedin':
                        previewHtml = this.getLinkedinPreview(url);
                        break;
                }

                content.html(previewHtml);
                container.removeClass('hidden');
            },

            getYoutubePreview: function(url) {
                let videoId = '';
                const patterns = [
                    /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/,
                    /youtube\.com\/watch\?.*v=([a-zA-Z0-9_-]{11})/
                ];
                
                for (let pattern of patterns) {
                    const match = url.match(pattern);
                    if (match) {
                        videoId = match[1];
                        break;
                    }
                }

                return `
                    <div class="space-y-3">
                        <div class="aspect-video rounded-lg overflow-hidden bg-slate-200">
                            <iframe width="100%" height="100%" src="https://www.youtube.com/embed/${videoId}" 
                                frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen></iframe>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-white rounded border border-slate-200">
                            <span class="text-red-500">‚ñ∂Ô∏è</span>
                            <div class="flex-1 truncate">
                                <p class="text-xs font-medium text-slate-700 truncate">${url}</p>
                            </div>
                            <span class="text-green-500 text-sm">‚úì</span>
                        </div>
                    </div>
                `;
            },

            getTiktokPreview: function(url) {
                return `
                    <div class="space-y-3">
                        <div class="p-4 bg-white rounded-lg border border-slate-200">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">‚ô™</span>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-slate-700">TikTok Video</p>
                                    <p class="text-xs text-slate-500 truncate">${url}</p>
                                </div>
                                <span class="text-green-500">‚úì</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-3 text-center">Preview akan ditampilkan setelah pengguna membuka link</p>
                        </div>
                    </div>
                `;
            },

            getInstagramPreview: function(url) {
                return `
                    <div class="space-y-3">
                        <div class="p-4 bg-white rounded-lg border border-slate-200">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">üì∑</span>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-slate-700">Instagram Post</p>
                                    <p class="text-xs text-slate-500 truncate">${url}</p>
                                </div>
                                <span class="text-green-500">‚úì</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-3 text-center">Preview akan ditampilkan setelah pengguna membuka link</p>
                        </div>
                    </div>
                `;
            },

            getFacebookPreview: function(url) {
                return `
                    <div class="space-y-3">
                        <div class="p-4 bg-white rounded-lg border border-slate-200">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl" style="color: #1877F2;">f</span>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-slate-700">Facebook Post</p>
                                    <p class="text-xs text-slate-500 truncate">${url}</p>
                                </div>
                                <span class="text-green-500">‚úì</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-3 text-center">Preview akan ditampilkan setelah pengguna membuka link</p>
                        </div>
                    </div>
                `;
            },

            getLinkedinPreview: function(url) {
                return `
                    <div class="space-y-3">
                        <div class="p-4 bg-white rounded-lg border border-slate-200">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl" style="color: #0A66C2;">in</span>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-slate-700">LinkedIn Post</p>
                                    <p class="text-xs text-slate-500 truncate">${url}</p>
                                </div>
                                <span class="text-green-500">‚úì</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-3 text-center">Preview akan ditampilkan setelah pengguna membuka link</p>
                        </div>
                    </div>
                `;
            },

            removeSosmed: function() {
                this.selectedUrl = null;
                this.selectedPlatform = null;
                $('#sosmed_url').val('');
                $('input[name="sosmed_platform"]').prop('checked', false);
                $('#sosmed-preview-container').addClass('hidden');
                Toast.show('Link dihapus', 'warning');
            }
        };

        // ============================================
        // FORM VALIDATION
        // ============================================
        const FormValidator = {
            errors: {},

            validateAll: function() {
                this.errors = {};
                this.clearErrors();
                
                this.validateIdentity();
                this.validateKategori();
                this.validateTerlapor();
                this.validateDeskripsi();
                this.validateBukti();
                this.validateCheckbox();
                
                return Object.keys(this.errors).length === 0;
            },

            validateIdentity: function() {
                const identitas = $('input[name="pelapor_identitas"]:checked').val();
                if (identitas === 'identitas') {
                    const nama = $('#pelapor_nama').val().trim();
                    const kontak = $('#pelapor_kontak').val().trim();
                    if (!nama) {
                        this.addError('pelapor_nama', 'Nama harus diisi');
                    }
                    if (!kontak) {
                        this.addError('pelapor_kontak', 'Kontak harus diisi');
                    } else if (!this.isValidEmail(kontak) && !this.isValidPhone(kontak)) {
                        this.addError('pelapor_kontak', 'Email atau WhatsApp tidak valid');
                    }
                }
            },

            validateKategori: function() {
                const kategori = $('#kategori_select').val();
                // Cek jika tidak dipilih atau masih placeholder
                if (!kategori || kategori === '' || kategori === 'Pilih kategori masalah...') {
                    this.addError('kategori_select', 'Kategori pelanggaran harus dipilih');
                }
            },

            validateTerlapor: function() {
                const jenis = $('#terlapor_jenis').val();
                let nama = '';
                if (!jenis || jenis === '') {
                    this.addError('terlapor_jenis', 'Pihak yang dilaporkan harus dipilih');
                    return;
                }
                // Pilih input nama sesuai jenis terlapor
                if (jenis === 'Mahasiswa') {
                    nama = $('#terlapor_nama_mahasiswa').val().trim();
                    const nim = $('#terlapor_nim').val().trim();
                    if (nim && nim.length < 5) {
                        this.addError('terlapor_nim', 'NIM tidak valid');
                    }
                    if (!nama) {
                        this.addError('terlapor_nama_mahasiswa', 'Nama pihak yang dilaporkan harus diisi');
                    }
                } else if (jenis === 'Dosen') {
                    nama = $('#terlapor_nama_dosen').val().trim();
                    if (!nama) {
                        this.addError('terlapor_nama_dosen', 'Nama pihak yang dilaporkan harus diisi');
                    }
                } else if (jenis === 'Tendik') {
                    nama = $('#terlapor_nama_tendik').val().trim();
                    if (!nama) {
                        this.addError('terlapor_nama_tendik', 'Nama pihak yang dilaporkan harus diisi');
                    }
                } else if (jenis === 'Lainnya') {
                    nama = $('#terlapor_nama_lainnya').val().trim();
                    if (!nama) {
                        this.addError('terlapor_nama_lainnya', 'Nama pihak yang dilaporkan harus diisi');
                    }
                }
            },

            validateDeskripsi: function() {
                const deskripsi = $('#kejadian_deskripsi').val().trim();
                const tgl = $('#kejadian_tgl').val();
                const lokasi = $('#kejadian_lokasi').val().trim();
                
                if (!deskripsi) {
                    this.addError('kejadian_deskripsi', 'Deskripsi kejadian harus diisi');
                } else if (deskripsi.length < 20) {
                    this.addError('kejadian_deskripsi', 'Deskripsi minimal 20 karakter');
                } else if (deskripsi.length > 2000) {
                    this.addError('kejadian_deskripsi', 'Deskripsi maksimal 2000 karakter');
                }
                
                if (!tgl) {
                    this.addError('kejadian_tgl', 'Tanggal kejadian harus diisi');
                }
                
                if (!lokasi) {
                    this.addError('kejadian_lokasi', 'Lokasi kejadian harus diisi');
                }
            },

            validateBukti: function() {
                // Bukti pendukung opsional, tidak perlu validasi wajib
                // Jika user mengisi, validasi sudah dilakukan oleh FileHandler/SosmedHandler
            },

            validateCheckbox: function() {
                if (!$('#agree_checkbox').is(':checked')) {
                    this.addError('agree_checkbox', 'Anda harus menyetujui pernyataan');
                }
            },

            addError: function(fieldId, message) {
                this.errors[fieldId] = message;
                // Cari field yang benar-benar terlihat (ancestor tidak hidden)
                const field = $(`#${fieldId}`).filter(function() {
                    return $(this).is(':visible') && $(this).closest('.hidden').length === 0;
                }).first();
                if (field.length > 0) {
                    field.addClass('input-error');
                    // Hapus pesan error lama di bawah field
                    if (field.next('.error-message').length === 0) {
                        field.after(`<span class="error-message"><span class="material-symbols-outlined text-[14px]">error</span>${message}</span>`);
                    }
                }
            },

            clearErrors: function() {
                $('.input-error').removeClass('input-error');
                $('.error-message').remove();
            },

            isValidEmail: function(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            },

            isValidPhone: function(phone) {
                const re = /^(\+62|0)[0-9]{9,12}$/;
                return re.test(phone.replace(/\D/g, ''));
            }
        };

        // ============================================
        // DESKRIPSI CHARACTER COUNTER
        // ============================================
        $('#kejadian_deskripsi').on('input', function() {
            const length = $(this).val().length;
            const parent = $(this).closest('.space-y-2');
            parent.find('span.bg-slate-100').text(`${length}/2000`);
            if (length > 2000) {
                $(this).val($(this).val().substring(0, 2000));
            }
        });

        // ============================================
        // FORM SUBMISSION VIA AJAX
        // ============================================
        $('#btn-kirim-pengaduan').on('click', function(e){
            e.preventDefault();
            console.log('Tombol submit diklik');
            // Validasi semua field di frontend
            const valid = FormValidator.validateAll();
            console.log('Hasil validasi:', valid);
            if (!valid) {
                console.log('Error validasi:', FormValidator.errors);
                Toast.show('Mohon periksa kembali form Anda', 'error');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return;
            }
            
            // Set loading state
            const btn = $(this);
            const originalText = btn.html();
            btn.disabled = true;
            btn.html(`<span class="material-symbols-outlined animate-spin text-[18px]">loading</span> Mengirim...`);
            
            // Prepare FormData (untuk support file upload)
            const formDataObj = new FormData();
            
            // Add text fields
            formDataObj.append('pelapor_identitas', $('input[name="pelapor_identitas"]:checked').val());
            formDataObj.append('pelapor_nama', $('#pelapor_nama').val() || '');
            formDataObj.append('pelapor_kontak', $('#pelapor_kontak').val() || '');
            formDataObj.append('kategori_id', $('#kategori_select').val());
            formDataObj.append('kategori_text', $('#kategori_select option:selected').text());
            formDataObj.append('terlapor_jenis', $('#terlapor_jenis').val());
            // Nama terlapor sesuai jenis
            const jenisTerlapor = $('#terlapor_jenis').val();
            if (jenisTerlapor === 'Mahasiswa') {
                formDataObj.append('terlapor_nama', $('#terlapor_nama_mahasiswa').val());
                if ($('#terlapor_prodi_id').val()) {
                    formDataObj.append('terlapor_prodi_id', $('#terlapor_prodi_id').val());
                }
            } else if (jenisTerlapor === 'Dosen') {
                formDataObj.append('terlapor_nama', $('#terlapor_nama_dosen').val());
            } else if (jenisTerlapor === 'Tendik') {
                formDataObj.append('terlapor_nama', $('#terlapor_nama_tendik').val());
            } else if (jenisTerlapor === 'Lainnya') {
                formDataObj.append('terlapor_nama', $('#terlapor_nama_lainnya').val());
            }
            formDataObj.append('terlapor_nim', $('#terlapor_nim').val() || '');
            formDataObj.append('kejadian_deskripsi', $('#kejadian_deskripsi').val());
            formDataObj.append('kejadian_tgl', $('#kejadian_tgl').val());
            formDataObj.append('kejadian_lokasi', $('#kejadian_lokasi').val());
            const buktiTipe = $('input[name="bukti_tipe"]:checked').val();
            formDataObj.append('bukti_tipe', buktiTipe);
            if (buktiTipe === 'sosmed') {
                if ($('input[name="sosmed_platform"]:checked').val()) {
                    formDataObj.append('bukti_sosmed_platform', $('input[name="sosmed_platform"]:checked').val());
                }
                if ($('#sosmed_url').val()) {
                    formDataObj.append('bukti_sosmed_url', $('#sosmed_url').val());
                }
            }
            
            // Add file jika ada
            const fileInput = document.getElementById('lampiran');
            if (fileInput && fileInput.files.length > 0) {
                formDataObj.append('lampiran', fileInput.files[0]);
            }
            
            // AJAX request
            $.ajax({
                type: 'POST',
                url: '<?= base_url('submit-pengaduan') ?>',
                data: formDataObj,
                processData: false,
                contentType: false,
                dataType: 'json',
                timeout: 30000,
                
                success: function(response) {
                    if (response.success) {
                        Toast.show(response.message, 'success');
                        
                        // Show success modal / redirect
                        setTimeout(function() {
                            // Reset form
                            $('#form-pengaduan')[0].reset();
                            FileHandler.removeFile();
                            SosmedHandler.removeSosmed();
                            // Redirect ke halaman sukses dengan referensi_pengaduan
                            if (response.data && response.data.referensi_pengaduan) {
                                window.location.href = '<?= base_url() ?>success/' + encodeURIComponent(response.data.referensi_pengaduan);
                            } else {
                                window.location.href = '<?= base_url() ?>';
                            }
                            // Clear errors
                            FormValidator.clearErrors();
                            // Scroll to top
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        }, 1500);
                    }
                },
                
                error: function(xhr, status, error) {
                    // Reset button
                    btn.disabled = false;
                    btn.html(originalText);
                    
                    // Handle different error types
                    if (xhr.status === 422) {
                        // Validation error
                        const response = xhr.responseJSON;
                        Toast.show(response.message || 'Validasi data gagal', 'error');
                        
                        // Show field errors
                        if (response.errors) {
                            Object.keys(response.errors).forEach(field => {
                                const fieldElement = $(`#${field}`);
                                if (fieldElement.length) {
                                    fieldElement.addClass('input-error');
                                    fieldElement.after(`<span class="error-message"><span class="material-symbols-outlined text-[14px]">error</span>${response.errors[field]}</span>`);
                                }
                            });
                        }
                    } else if (xhr.status === 400) {
                        Toast.show('Request tidak valid', 'error');
                    } else if (xhr.status === 500) {
                        const response = xhr.responseJSON;
                        Toast.show(response.message || 'Terjadi kesalahan server', 'error');
                        console.error('Server error details:', response);
                    } else if (status === 'timeout') {
                        Toast.show('Request timeout. Coba lagi', 'error');
                    } else {
                        Toast.show(`Error: ${status}`, 'error');
                        console.error('AJAX error:', status, error);
                    }
                    
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                },
                
                complete: function() {
                    // Always reset button state
                    btn.disabled = false;
                    btn.html(originalText);
                }
            });
        });

        // Initialize file handler
        FileHandler.init();
        
        // Initialize social media handler
        SosmedHandler.init();
    });

</script>

</body></html>